SELECT
    CCL.Exchange_Rate_Type,
    CCL.Credit_Currency_Code,
    CCL.Credit_Hold,
    NVL(CCL.Credit_Limit, 0) Credit_Limit,
    NVL(TB.TOTAL_BALANCE, 0) TOTAL_BALANCE, 
    NVL(OCA.OpenCreditAutho_Amount, 0) OpenCreditAutho_Amount,
    NVL(CCL.Credit_Limit, 0) - NVL(TB.TOTAL_BALANCE, 0) - NVL(OCA.OpenCreditAutho_Amount, 0) AS AvailableCreditLimit
FROM
    (
        SELECT ROUND(Credit_Limit,2) Credit_Limit, Exchange_Rate_Type, Credit_Currency_Code, Credit_Hold
        FROM hz_customer_profiles_f
        WHERE cust_account_id = (
            SELECT Cust_Account_Id FROM FUSION.Hz_Cust_Accounts WHERE Account_Number = :p_account_number
        )
        AND (CURRENT_DATE BETWEEN effective_start_date AND effective_end_date)
        AND site_use_id IS NULL
        AND status = 'A'
    ) CCL,
    (
        SELECT ROUND(TOTAL_BALANCE,2) AS TOTAL_BALANCE
        FROM ar_total_balance_view
        WHERE cust_account_id = (
            SELECT Cust_Account_Id FROM FUSION.Hz_Cust_Accounts WHERE Account_Number = :p_account_number
        )
    ) TB,
    (
        SELECT ROUND(SUM(REM_AUTH_AMOUNT),2) AS OpenCreditAutho_Amount
        FROM FUSION.AR_CUST_CREDIT_AUTHORIZATION
        WHERE AUTHORIZATION_STATUS = 'OPEN'
        AND cust_account_id = (
            SELECT Cust_Account_Id FROM FUSION.Hz_Cust_Accounts WHERE Account_Number = :p_account_number
        )
    ) OCA